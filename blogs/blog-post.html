<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Blog post by Tife.">
  <meta property="og:title" content="Tife - Blog Post">
  <meta property="og:description" content="Read the latest blog post by Tife.">
  <meta property="og:image" content="/assets/Low_res/crabapple.JPG">
  <meta property="og:url" content="https://tifelabs.com/blogs/blog-post.html">
  <meta name="twitter:card" content="summary_large_image">
  <title>Tife - Blog Post</title>
  <link rel="stylesheet" href="../css/blog.css">
  <link rel="icon" href="../assets/images/baby.png">
  
  <!-- Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-W3CM55WK3Y"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-W3CM55WK3Y');
  </script>
  
  <!-- Markdown Parser -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <header>
    <h1>Tife</h1>
    <div class="subtitle">Writing</div>
  </header>
  
  <nav>
    <ul>
      <li><a href="../index.html">λ</a></li>
      <li><a href="index.html" class="active">Writing</a></li>
      <li><a href="../Photography/">Photography</a></li>
      <li><a href="index.html">&larr; Back to Blogs</a></li>
    </ul>
  </nav>
  
  <main>
    <article class="content">
      <h2 id="post-title">Loading...</h2>
      <div id="post-content"></div>
    </article>
  </main>
  
  <!-- Image Modal -->
  <div id="modal" class="modal" role="dialog" aria-label="Image viewer" aria-hidden="true">
    <button class="modal-close" aria-label="Close modal">⚔️</button>
    <img id="modal-content" src="" alt="">
  </div>
  
  <footer>
    <p>&copy; 2025 Tife. All rights reserved.</p>
  </footer>
  
  <script>
    'use strict';
    
    // Get markdown file from URL parameter
    const params = new URLSearchParams(window.location.search);
    const mdFile = (params.get('md') || 'default.md').split('/').pop();
    
    // Load and render markdown
    async function loadPost() {
      try {
        const response = await fetch(`/blogs/posts/${mdFile}`);
        
        if (!response.ok) {
          throw new Error(`${response.status} ${response.statusText}`);
        }
        
        const text = await response.text();
        
        // Extract title from first H1
        const titleMatch = text.match(/^# (.+)/m);
        const title = titleMatch ? titleMatch[1] : 'Untitled Post';
        const content = titleMatch ? text.replace(/^# .+\n+/, '') : text;
        
        // Render content
        document.getElementById('post-content').innerHTML = marked.parse(content);
        document.getElementById('post-title').textContent = title;
        document.title = `Tife - ${title}`;
        
        // Setup image click handlers
        setupImageModal();
        
      } catch (error) {
        document.getElementById('post-content').innerHTML = 
          `<p style="color: #e53e3e;">Error loading blog post: ${error.message}. Please check the file path or try again later.</p>`;
        console.error('Fetch error:', error);
      }
    }
    
    // Setup image modal functionality
    function setupImageModal() {
      const modal = document.getElementById('modal');
      const modalImg = document.getElementById('modal-content');
      const closeBtn = document.querySelector('.modal-close');
      
      // Add click handlers to all images
      document.querySelectorAll('.content img').forEach(img => {
        img.addEventListener('click', () => {
          modal.style.display = 'flex';
          modal.setAttribute('aria-hidden', 'false');
          modalImg.src = img.src;
          modalImg.alt = img.alt;
          document.body.style.overflow = 'hidden';
        });
      });
      
      // Close modal function
      function closeModal() {
        modal.style.display = 'none';
        modal.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
      }
      
      // Close button
      closeBtn.addEventListener('click', closeModal);
      
      // Click outside to close
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });
      
      // Escape key to close
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.style.display === 'flex') {
          closeModal();
        }
      });
    }
    
    // Load post when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadPost);
    } else {
      loadPost();
    }
  </script>
</body>
</html>